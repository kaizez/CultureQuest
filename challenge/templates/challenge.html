{% extends "base.html" %}

{% block title %}Create Challenge - CultureQuest{% endblock %}

{% block content %}
    <header class="challenge-header">
        <h1>Create a New Challenge</h1>
    </header>

    <div class="challenge-form-container">
        <div class="create-challenge-section">
            <form action="{{ url_for('challenge.create_challenge') }}" method="POST" enctype="multipart/form-data" class="create-challenge-form">
                {{ form.hidden_tag() }}

                <div class="form-group">
                    {{ form.challenge_name.label(class="form-label") }}
                    {{ form.challenge_name(class="form-input", placeholder="Enter the name of your challenge") }}
                    {% for error in form.challenge_name.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                </div>

                <div class="form-group">
                    {{ form.description.label(class="form-label") }}
                    {{ form.description(class="form-textarea", placeholder="Describe your challenge in detail. What is it about? What will participants learn or experience?") }}
                    {% for error in form.description.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                </div>

                <div class="form-group">
                    {{ form.completion_criteria.label(class="form-label") }}
                    {{ form.completion_criteria(class="form-textarea", placeholder="Explain how participants can show they have completed the challenge. What evidence or proof is needed?") }}
                    {% for error in form.completion_criteria.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                </div>

                <div class="form-group">
                    {{ form.media.label(class="form-label") }}
                    {{ form.media(class="form-input") }}
                    <p style="font-size: 13px; color: #6b7280; margin-top: 4px;">Upload an image or video to help explain your challenge</p>
                    {% for error in form.media.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                </div>

                <div class="form-group">
                    <button type="submit" class="form-button" style="width: 100%;" id="submit-btn">Submit Challenge</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Show success popup if challenge was created
        {% if show_success_popup %}
        showSuccessPopup();
        {% endif %}

        // Add smooth form interactions
        const textareas = document.querySelectorAll('.form-textarea');
        textareas.forEach(textarea => {
            textarea.addEventListener('focus', function() {
                this.style.borderColor = '#6366f1';
                this.style.boxShadow = '0 0 0 3px rgba(99, 102, 241, 0.1)';
            });
            textarea.addEventListener('blur', function() {
                this.style.borderColor = '#d1d5db';
                this.style.boxShadow = 'none';
            });
        });

        // Add hover effect to submit button
        const submitBtn = document.getElementById('submit-btn');
        submitBtn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-1px)';
        });
        submitBtn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });

    function showSuccessPopup() {
        // Create popup overlay
        const overlay = document.createElement('div');
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        `;

        // Create popup content
        const popup = document.createElement('div');
        popup.style.cssText = `
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
        `;

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: scale(0.8); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
        `;
        document.head.appendChild(style);

        popup.innerHTML = `
            <div style="color: #10b981; font-size: 48px; margin-bottom: 16px;">âœ“</div>
            <h2 style="color: #111827; margin-bottom: 12px; font-size: 24px;">Success!</h2>
            <p style="color: #6b7280; margin-bottom: 24px; font-size: 16px;">Your challenge has been created successfully!</p>
            <button onclick="closePopup()" style="
                background: #6366f1;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                font-size: 16px;
                cursor: pointer;
                transition: background 0.2s;
            " onmouseover="this.style.background='#5856eb'" onmouseout="this.style.background='#6366f1'">
                Continue
            </button>
        `;

        overlay.appendChild(popup);
        document.body.appendChild(overlay);

        // Close popup function
        window.closePopup = function() {
            document.body.removeChild(overlay);
        };

        // Close on overlay click
        overlay.addEventListener('click', function(e) {
            if (e.target === overlay) {
                closePopup();
            }
        });
    }
</script>
{% endblock %}