{% extends "base.html" %}

{% block title %}Approved Challenges - CultureQuest{% endblock %}

{% block content %}
    <header class="challenge-header">
        <h1>Challenges</h1>
    </header>

    <div class="challenge-form-container" style="max-width: 1400px;">
        <!-- Featured Challenge -->
        {% if featured_challenge %}
            <div class="featured-challenge">
                <div class="featured-challenge-image-container">
                    {% if featured_challenge['media'] %}
                        <img src="{{ url_for('static', filename='uploads/' + featured_challenge['media']) }}" alt="{{ featured_challenge['challenge_name'] or featured_challenge['name'] }}" class="featured-challenge-image">
                    {% else %}
                        <div class="featured-challenge-image" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); display: flex; align-items: center; justify-content: center; color: #6b7280; font-size: 16px;">
                            No image available
                        </div>
                    {% endif %}
                </div>
                
                <div class="featured-challenge-content">
                    <h2>{{ featured_challenge['challenge_name'] or featured_challenge['name'] }}</h2>
                    
                    <div class="featured-challenge-section">
                        <div class="featured-section-title">Description</div>
                        <div class="featured-section-content">{{ featured_challenge['description'] }}</div>
                    </div>
                    
                    {% if featured_challenge['completion_criteria'] %}
                        <div class="featured-challenge-section">
                            <div class="featured-section-title">Completion Criteria</div>
                            <div class="featured-section-content">{{ featured_challenge['completion_criteria'] }}</div>
                        </div>
                    {% endif %}
                </div>
            </div>
        {% endif %}

        <!-- Challenge Grid -->
        {% if challenges %}
            <div class="challenges-grid">
                {% for challenge in challenges %}
                    <div class="challenge-card">
                        <div class="challenge-card-image">
                            {% if challenge['media'] %}
                                <img src="{{ url_for('static', filename='uploads/' + challenge['media']) }}" alt="{{ challenge['challenge_name'] or challenge['name'] }}">
                            {% else %}
                                <!-- Show truncated description when no image -->
                                <div class="challenge-card-description" style="padding: 16px; height: 100%; display: flex; align-items: center; justify-content: center; text-align: center;">
                                    {{ challenge['description'][:120] }}{% if challenge['description']|length > 120 %}...{% endif %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="challenge-card-content">
                            <h3 class="challenge-card-title">{{ challenge['challenge_name'] or challenge['name'] }}</h3>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if pagination and pagination.total_pages > 1 %}
                <div class="pagination">
                    {% if pagination.has_prev %}
                        <a href="{{ url_for('event.event_page', page=pagination.prev_num) }}" class="pagination-btn">← Previous</a>
                    {% else %}
                        <span class="pagination-btn disabled">← Previous</span>
                    {% endif %}

                    {% for page_num in range(1, pagination.total_pages + 1) %}
                        {% if page_num == pagination.page %}
                            <span class="pagination-btn active">{{ page_num }}</span>
                        {% else %}
                            <a href="{{ url_for('event.event_page', page=page_num) }}" class="pagination-btn">{{ page_num }}</a>
                        {% endif %}
                    {% endfor %}

                    {% if pagination.has_next %}
                        <a href="{{ url_for('event.event_page', page=pagination.next_num) }}" class="pagination-btn">Next →</a>
                    {% else %}
                        <span class="pagination-btn disabled">Next →</span>
                    {% endif %}
                </div>

                <div class="pagination-info">
                    Showing {{ ((pagination.page - 1) * pagination.per_page + 1) if challenges else 0 }} - {{ ((pagination.page - 1) * pagination.per_page + challenges|length) if challenges else 0 }} of {{ pagination.total }} challenges
                </div>
            {% endif %}
        {% elif not featured_challenge %}
            <!-- Empty State -->
            <div class="empty-state">
                <h2>No challenges available</h2>
                <p>Check back later for new cultural challenges!</p>
            </div>
        {% endif %}
    </div>
{% endblock %}
